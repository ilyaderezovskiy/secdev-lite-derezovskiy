# S04 - Шаблон STRIDE per element (матрица)

Этот файл - рабочая матрица **без оценок**: фиксируем релевантные угрозы для каждого элемента и потока из вашей DFD (mermaid), связываем их с NFR из S03 и накидываем идею mitigation (для будущих ADR на S05).

> Рабочее расположение у студента: `SEMINARS/S04/S04_stride_matrix.md`.
> Оценивание L×I (1-5) и выбор Top-5 делаются **отдельно** в `S04_risk_scoring.md`.
> Семинарские артефакты в `/EVIDENCE/` **не кладём**.

---

## Как работать с матрицей

1. Возьмите элементы вашей DFD: **узлы** (API, Service, DB, External) и **рёбра/потоки** (JWT, PII, files, payments).
2. Для **каждого** элемента пройдите буквы **STRIDE** и зафиксируйте **только релевантные** угрозы (0-2 на букву).
3. Для каждой угрозы:

   * кратко опишите **Description** (1-2 предложения, по делу);
   * укажите **NFR link (ID)** из реестра S03 (или `need NFR`, если такого ещё нет);
   * добавьте **Mitigation idea (ADR later)** - короткое имя решения, которое пойдёт в ADR на S05.

---

## Легенда STRIDE

* **S - Spoofing:** подмена идентичности/токена.
* **T - Tampering:** изменение данных/запросов/конфигурации.
* **R - Repudiation:** отрицание действий (нет аудита/трассировки).
* **I - Information disclosure:** утечка конфиденциальных данных (PII/секреты).
* **D - Denial of service:** отказ в обслуживании (ресурсное истощение/«залипание»).
* **E - Elevation of privilege:** повышение привилегий/обход RBAC/тенант-изоляции.

---

## Примеры строк (образец заполнения)

| Element                      | Data/Boundary | Threat (S/T/R/I/D/E) | Description                                            | NFR link (ID)                   | Mitigation idea (ADR later)               |
| ---------------------------- | ------------- | -------------------- | ------------------------------------------------------ | ------------------------------- | ----------------------------------------- |
| Edge: Internet → API         | JWT / public  | S                    | Повтор/подмена токена, reuse истёкшего/украденного JWT | NFR-AuthN, NFR-RateLimit        | JWT TTL+Refresh, rate limit на `/auth/*`  |
| Node: Service                | Logs          | I                    | PII в логах и сообщениях об ошибках                    | NFR-Privacy/PII, NFR-API-Errors | Маскирование PII, RFC7807 без стэктрейсов |
| Edge: Service → External API | HTTP/gRPC     | D                    | Залипание без timeout/retry/circuit breaker            | NFR-Timeouts/Retry/CB           | Timeout≤2s, retry≤3 с джиттером, CB       |

> После заполнения матрицы **перенесите уникальные/объединённые риски** в `S04_risk_scoring.md` для приоритизации L×I (1-5) и выбора Top-5.

---

## Матрица для заполнения

| Element | Data/Boundary | Threat (S/T/R/I/D/E) | Description | NFR link (ID) | Mitigation idea (ADR later) |
| ------- | ------------- | -------------------- | ----------- | ------------- | --------------------------- |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |
|         |               |                      |             |               |                             |

---

## Самопроверка (быстро)

* [ ] Пройдены **все узлы и рёбра** вашей DFD.
* [ ] У угроз стоят **NFR link (ID)** или пометка `need NFR`.
* [ ] У каждой угрозы есть понятная **Mitigation idea** (будущий ADR).
* [ ] Нет «воды»: кратко, по делу, без оценок L/I (они - в `S04_risk_scoring.md`).
