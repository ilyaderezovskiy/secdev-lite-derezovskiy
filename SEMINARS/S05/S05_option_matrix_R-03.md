# S05 - Матрица вариантов (Option Matrix) - шаблон

> Рабочее расположение у студента: `SEMINARS/S05/S05_option_matrix_<risk-id>.md`
> Цель: быстро сравнить **2-3 альтернативы** по одному выбранному риску и аргументировать выбор для ADR.
> Никаких «оценок»/баллов курса - это вспомогательный артефакт для принятия решения.

---

## 0) Контекст риска (из S04)

* **Risk-ID:** `<R-..>`     **Threat:** `S|T|R|I|D|E`
* **DFD element/edge:** `<из S04_dfd.md>`
* **NFR link (ID):** `<из S03>`
* **L×I (1-5):** `L=<..>, I=<..>, Score=<..>`
* **Ограничения/предпосылки:** стек, регуляторка, SLO/SLA и т. п. (кратко)

---

## 1) Критерии и шкалы (1-5)

**Польза (чем больше - тем лучше, ↑):**

* **Security impact (↑):** насколько альтернатива снижает риск (предотвращает/обнаруживает/сдерживает).
* **Blast radius reduction (↑):** насколько сужает возможный ущерб (только один тенант/аккаунт/фича вместо всего сервиса).

**Стоимость/сложность (чем меньше - тем лучше, ↓):**

* **Complexity (↓):** сложность внедрения (код/конфиг/политики).
* **Time-to-mitigate (↓):** сколько времени до эффекта (в днях/спринтах).
* **Dependencies (↓):** внешние/внутренние зависимости (команды, провайдеры, миграции).

> Оценка **1-5**: 1 - минимально / 5 - максимально. Для «стоимостных» критериев **меньше - лучше**.

**Итоговые метрики (подсказка):**

* **Benefit = Security impact + Blast radius reduction**
* **Cost = Complexity + Time-to-mitigate + Dependencies**
* **Net = Benefit − Cost**  *(чем больше, тем привлекательнее)*

---

## 2) Таблица сравнения вариантов

| Alternative | Summary (1-2 фразы) | Security impact (↑,1-5) | Blast radius reduction (↑,1-5) | Complexity (↓,1-5) | Time-to-mitigate (↓,1-5) | Dependencies (↓,1-5) | **Benefit** | **Cost** | **Net** | Notes |
| ----------- | ------------------- | ----------------------: | -----------------------------: | -----------------: | -----------------------: | -------------------: | ----------: | -------: | ------: | ----- |
| A           |                     |                         |                                |                    |                          |                      |             |          |         |       |
| B           |                     |                         |                                |                    |                          |                      |             |          |         |       |
| C *(опц.)*  |                     |                         |                                |                    |                          |                      |             |          |         |       |

> **Как считать:**
> `Benefit = Security impact + Blast radius reduction`
> `Cost = Complexity + Time-to-mitigate + Dependencies`
> `Net = Benefit − Cost`

---

## 3) Тай-брейкеры при равенстве Net

* **Compliance/Privacy:** влияет ли на требования приватности/платежей/регулятора.
* **Maintainability:** насколько просто сопровождать/эксплуатировать.
* **Team fit:** есть ли экспертиза у команды сейчас.
* **Observability:** как будем наблюдать/детектировать.
* **Rollback safety:** насколько безопасен откат.

---

## 4) Решение (для переноса в ADR)

* **Chosen alternative:** `<A|B|C>`
* **Почему:** 2-4 предложения (опирайтесь на критерии и тай-брейкеры).
* **ADR candidate (название):** `<например, “JWT TTL + Refresh + Rotation”>`
* **Связки:** Risk-ID `<…>`, NFR-ID `<…>`, DFD `<…>`
* **Следующие шаги (минимум):** 3-5 пунктов «что меняем» (конфиг/политика/флаг/порог).

---

## 5) Пример заполнения (можно удалить)

> Риск: `R-03` - повторное использование украденного JWT (Edge Internet→API).
> Альтернативы: **A** - «JWT TTL+Refresh+Rotation», **B** - «mTLS клиент-сервер».

| Alternative | Summary                                     | Sec. impact | Blast red. | Complexity | Time | Deps | **Benefit** | **Cost** | **Net** | Notes                                   |
| ----------- | ------------------------------------------- | ----------: | ---------: | ---------: | ---: | ---: | ----------: | -------: | ------: | --------------------------------------- |
| A           | Короткий TTL, refresh-поток, ротация ключей |           4 |          3 |          2 |    2 |    2 |       **7** |    **6** |  **+1** | Быстро, почти без внешних зависимостей  |
| B           | Взаимная TLS аутентификация клиента         |           5 |          4 |          4 |    4 |    5 |       **9** |   **13** |  **−4** | Сложно и долго, зависит от PKI/клиентов |

**Chosen:** A - быстрее даёт эффект, проще откат/масштабирование. ADR: *“JWT TTL + Refresh + Rotation”*.

---

## 6) Самопроверка

* [ ] Риск и контекст из S04 указаны (Risk-ID, DFD, NFR-ID, L×I).
* [ ] Сравнили **минимум 2 альтернативы**.
* [ ] Заполнены все критерии 1-5; посчитаны Benefit/Cost/Net.
* [ ] Описаны тай-брейкеры (если Net равен).
* [ ] Принято решение и зафиксирован **ADR candidate**.
* [ ] Готовы перенести решение в **`S05_ADR_<slug>.md`** (шаблон ADR).

---
